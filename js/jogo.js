const temas = {
  'Halloween': {
    // https://www.flaticon.com/br/packs/halloween-17
    icones: [
      {
        urlIcone: 'https://cdn-icons-png.flaticon.com/512/249/249389.png',
        alt: 'Aranha preta'
      },
      {
        urlIcone: 'https://cdn-icons-png.flaticon.com/512/249/249405.png',
        alt: 'Bola de cristal'
      },
      {
        urlIcone: 'https://cdn-icons-png.flaticon.com/512/249/249406.png',
        alt: 'Parede com gosmenta'
      },
      {
        urlIcone: 'https://cdn-icons-png.flaticon.com/512/249/249393.png',
        alt: 'Espantalho'
      },
      {
        urlIcone: 'https://cdn-icons-png.flaticon.com/512/249/249408.png',
        alt: 'Poções'
      },
      {
        urlIcone: 'https://cdn-icons-png.flaticon.com/512/249/249396.png',
        alt: 'Caixão'
      },
      {
        urlIcone: 'https://cdn-icons-png.flaticon.com/512/249/249410.png',
        alt: 'Frankeinstein'
      },
      {
        urlIcone: 'https://cdn-icons-png.flaticon.com/512/249/249411.png',
        alt: 'Foice'
      },
      {
        urlIcone: 'https://cdn-icons-png.flaticon.com/512/249/249412.png',
        alt: 'Coruja'
      },
      {
        urlIcone: 'https://cdn-icons-png.flaticon.com/512/249/249413.png',
        alt: 'Diabo'
      },

      {
        urlIcone: 'https://cdn-icons-png.flaticon.com/512/249/249414.png',
        alt: 'Mumia'
      },
      {
        urlIcone: 'https://cdn-icons-png.flaticon.com/512/249/249381.png',
        alt: 'Olho em conserva'
      },
      {
        urlIcone: 'https://cdn-icons-png.flaticon.com/512/249/249398.png',
        alt: 'Braço do Frankeinstein'
      },
      {
        urlIcone: 'https://cdn-icons-png.flaticon.com/512/249/249418.png',
        alt: 'Faca ensanguentada'
      },
      {
        urlIcone: 'https://cdn-icons-png.flaticon.com/512/249/249404.png',
        alt: 'Tridente do capeta'
      },
      {
        urlIcone: 'https://cdn-icons-png.flaticon.com/512/249/249401.png',
        alt: 'Boneco vudu'
      },
      {
        urlIcone: 'https://cdn-icons-png.flaticon.com/512/249/249376.png',
        alt: 'Bruxa'
      },
      {
        urlIcone: 'https://cdn-icons-png.flaticon.com/512/249/249420.png',
        alt: 'Corpo decepado'
      },
      {
        urlIcone: 'https://cdn-icons-png.flaticon.com/512/249/249386.png',
        alt: 'Morcego'
      },
      {
        urlIcone: 'https://cdn-icons-png.flaticon.com/512/249/249397.png',
        alt: 'Seputura'
      },
    ],
    verso: 'https://cdn-icons-png.flaticon.com/512/249/249395.png'
  },

  'Roupas' : {
    //https://www.flaticon.com/br/packs/summer-clothing-34?word=roupas
    icones: [
      {
        urlIcone: 'https://cdn-icons-png.flaticon.com/512/4813/4813598.png',
        alt: 'Óculos'
      },
      {
        urlIcone: 'https://cdn-icons-png.flaticon.com/512/4813/4813956.png',
        alt: 'Calça jeans'
      },
      {
        urlIcone: 'https://cdn-icons-png.flaticon.com/512/4813/4813525.png',
        alt: 'Bolsa'
      },
      {
        urlIcone: 'https://cdn-icons-png.flaticon.com/512/4813/4813669.png',
        alt: 'Camisa verde com estampa de sol'
      },
      {
        urlIcone: 'https://cdn-icons-png.flaticon.com/512/4813/4813537.png',
        alt: 'Chinelo com fivela de sol'
      },
      {
        urlIcone: 'https://cdn-icons-png.flaticon.com/512/4815/4815782.png',
        alt: 'Camisa vermelha listrada'
      },
      {
        urlIcone: 'https://cdn-icons-png.flaticon.com/512/4813/4813581.png',
        alt: 'Biquíni verde'
      },
      {
        urlIcone: 'https://cdn-icons-png.flaticon.com/512/4813/4813766.png',
        alt: 'Calça jeans azul'
      },
      {
        urlIcone: 'https://cdn-icons-png.flaticon.com/512/4813/4813544.png',
        alt: 'Maiô amarelo'
      },
      {
        urlIcone: 'https://cdn-icons-png.flaticon.com/512/4813/4813589.png',
        alt: 'Chenila vermelha'
      },
      {
        urlIcone: 'https://cdn-icons-png.flaticon.com/512/4813/4813530.png',
        alt: 'Óculos de sol'
      },
      {
        urlIcone: 'https://cdn-icons-png.flaticon.com/512/4813/4813773.png',
        alt: 'Tênis'
      },
      {
        urlIcone: 'https://cdn-icons-png.flaticon.com/512/4813/4813978.png',
        alt: 'Chinelo verde'
      },
      {
        urlIcone: 'https://cdn-icons-png.flaticon.com/512/4813/4813519.png',
        alt: 'Chapéu rosa'
      },
      {
        urlIcone: 'https://cdn-icons-png.flaticon.com/512/4813/4813567.png',
        alt: 'Chapéu vermelho'
      },
      {
        urlIcone: 'https://cdn-icons-png.flaticon.com/512/4813/4813652.png',
        alt: 'Blusa roxa'
      },
      {
        urlIcone: 'https://cdn-icons-png.flaticon.com/512/4813/4813934.png',
        alt: 'Mochila'
      },
      {
        urlIcone: 'https://cdn-icons-png.flaticon.com/512/4813/4813881.png',
        alt: 'Óculos em formato de coração'
      },
      {
        urlIcone: 'https://cdn-icons-png.flaticon.com/512/4813/4813969.png',
        alt: 'Camisa azul'
      },
      {
        urlIcone: 'https://cdn-icons-png.flaticon.com/512/4813/4813919.png',
        alt: 'Vestido vermelho e rosa'
      },
    ],

    verso: 'https://cdn-icons-png.flaticon.com/512/4814/4814008.png'
  },

  'Pascoa': {
    icones: [
      // https://www.flaticon.com/br/packs/easter-13?word=pascoa
      {
        urlIcone: 'https://cdn-icons-png.flaticon.com/512/347/347442.png',
        alt: 'Coelho'
      },
      {
        urlIcone: 'https://cdn-icons-png.flaticon.com/512/347/347471.png',
        alt: 'Pinto e coelho com ovo de páscoa'
      },
      {
        urlIcone: 'https://cdn-icons-png.flaticon.com/512/347/347436.png',
        alt: 'Ovo de páscoa'
      },
      {
        urlIcone: 'https://cdn-icons-png.flaticon.com/512/347/347443.png',
        alt: '3 ovos de páscoa'
      },
      {
        urlIcone: 'https://cdn-icons-png.flaticon.com/512/347/347444.png',
        alt: 'Coelho saindo de um ovo de páscoa'
      },
      {
        urlIcone: 'https://cdn-icons-png.flaticon.com/512/347/347460.png',
        alt: 'Bíblia'
      },
      {
        urlIcone: 'https://cdn-icons-png.flaticon.com/512/347/347451.png',
        alt: 'Vela'
      },
      {
        urlIcone: 'https://cdn-icons-png.flaticon.com/512/347/347455.png',
        alt: 'Coelho segurando ovo de páscoa'
      },
      {
        urlIcone: 'https://cdn-icons-png.flaticon.com/512/347/347465.png',
        alt: 'Jesus'
      },
      {
        urlIcone: 'https://cdn-icons-png.flaticon.com/512/347/347463.png',
        alt: 'Ovo de chocolate'
      },
      {
        urlIcone: 'https://cdn-icons-png.flaticon.com/512/347/347457.png',
        alt: 'Cruz'
      },
      {
        urlIcone: 'https://cdn-icons-png.flaticon.com/512/347/347447.png',
        alt: 'Ovo de páscoa sendo pintado'
      },
      {
        urlIcone: 'https://cdn-icons-png.flaticon.com/512/347/347462.png',
        alt: 'Ramo de oliveira'
      },
      {
        urlIcone: 'https://cdn-icons-png.flaticon.com/512/347/347440.png',
        alt: 'Cesta com ovo de pacoa'
      },
      {
        urlIcone: 'https://cdn-icons-png.flaticon.com/512/347/347474.png',
        alt: 'Vinho'
      },
      {
        urlIcone: 'https://cdn-icons-png.flaticon.com/512/347/347466.png',
        alt: 'Pintinho segurando um ovo de páscoa'
      },
      {
        urlIcone: 'https://cdn-icons-png.flaticon.com/512/347/347456.png',
        alt: 'Calice'
      },
      {
        urlIcone: 'https://cdn-icons-png.flaticon.com/512/347/347469.png',
        alt: '3 cruzes'
      },
      {
        urlIcone: 'https://cdn-icons-png.flaticon.com/512/347/347453.png',
        alt: '3 ovos de páscoa envoltos por flores'
      },
      {
        urlIcone: 'https://cdn-icons-png.flaticon.com/512/347/347441.png',
        alt: 'Igreja'
      },
    ],

    verso: 'https://cdn-icons-png.flaticon.com/512/347/347449.png'
  }
}

function criarCopiaCartas(cartas) {
  cartas.forEach(carta => {
    cartas.push(carta)
  })

  return cartas
}

function carregarCartas(cartasUl, cartas) {
  let tamImg = 80

  cartas.forEach(carta => {
    let li = document.createElement('li')
    let button = document.createElement('button')
    let img = document.createElement('img')

    li.classList.add('selecionar-carta')

    button.classList.add('carta')
    button.type = 'button'

    img.classList.add('esconder-carta')
    img.src = carta.urlIcone
    img.alt = carta.alt
    img.width = tamImg
    img.height = tamImg

    cartasUl.appendChild(li)
    li.appendChild(button)
    button.appendChild(img)
  })
}

function compararCartas(parCartas) {
  let [carta1, carta2] = [parCartas[0], parCartas[1]]
  let imgCarta1 = carta1.children[0]
  let imgCarta2 = carta2.children[0]
  
  return imgCarta1.src === imgCarta2.src
}

function bloquearCarta(cartaButton) {
  cartaButton.disabled = true
}

function liberarCarta(cartaButton) {
  cartaButton.disabled = false
}

function vitoria(numeroPalpites, tempo) {
  let msgVitoriaElemento = document.createElement('h1')
  let numeroPalpiteElemento = document.createElement('h2')

  msgVitoriaElemento.textContent = 'Ganhou, parabens'
  numeroPalpiteElemento.textContent = `Tentativas: ${numeroPalpites}`
  
  let informacoesJogo = document.querySelector('#informacoes-fim-jogo')

  informacoesJogo.appendChild(msgVitoriaElemento)
  informacoesJogo.appendChild(numeroPalpiteElemento)

  document.querySelector('#contador span').classList.add('pisca-pisca')
}

function resetarInformacoesRodada() {
  return [null, []]
}

function revelarCarta(cartaButton) {
  cartaButton.children[0].classList.remove('esconder-carta')
  cartaButton.children[0].classList.add('revelar-carta')
}

function esconderCarta(cartaButton) {
  cartaButton.children[0].classList.add('esconder-carta')
  cartaButton.children[0].classList.remove('revelar-carta')
}

function gerarNumeroAleatorio(limiteMax) {
  return Math.floor(Math.random() * limiteMax)
}

function embaralharCartas(cartas) {
  let indicesSorteados = []
  let paresTrocados = 0
  let numeroPares = cartas.length / 2

  while (paresTrocados < numeroPares) {
    let indiceOrigem = gerarNumeroAleatorio(cartas.length)
    let indiceDestino = gerarNumeroAleatorio(cartas.length)

    if (indicesSorteados.includes(indiceOrigem) == false && indicesSorteados.includes(indiceDestino) == false) {
      let trocar = cartas[indiceDestino]
      cartas[indiceDestino] = cartas[indiceOrigem]
      cartas[indiceOrigem] = trocar
      paresTrocados++

      indicesSorteados.push(indiceOrigem)
      indicesSorteados.push(indiceDestino)
    }
  }
  
  return cartas
}

// nao usada
function piscarTela(color) {
  hexadecimal = {
    'red': '#bb2d3b',
    'green': '#198754'
  }

  corOriginal = document.body.style.backgroundColor
  document.body.style.backgroundColor = hexadecimal[color]

  setTimeout(() => {
    document.body.style.backgroundColor = corOriginal
  }, 500)
}

function adicionarEfeitoCartaSelecionada(cartaButton) {
  cartaButton.classList.add('carta-selecionada')
}

function removerEfeitoCartaSelecionada(cartaButton) {
  cartaButton.classList.remove('carta-selecionada')
}

function esperar(ms) {
  return new Promise(resolve => setTimeout(resolve, ms))
}

function definirDificuldade(dificuldade, cartas) {
  let numeroCartas = 15

  if (dificuldade == '1') {
    numeroCartas = 10
  } else if (dificuldade == '2') {
    numeroCartas = 15
  } else if (dificuldade == '3') {
    numeroCartas = 20
  }

  cartas = cartas.slice(0, numeroCartas)

  return cartas
}

function atualizarCronometro(cronometro) {
  let contador = document.querySelector('#contador span')
  let tempoAtualizado = Date.now()
  let tempo = Math.floor((tempoAtualizado - cronometro) / 1000) // tempo em segundos

  let minutos = Math.floor(tempo / 60)
  let segundos = tempo % 60

  contador.textContent = `${minutos}:${segundos}s`
  cronometro = `${minutos}:${segundos}s`
}

function iniciarCronometro(cronometro) {
  let tempoAtualizacaoCronometro = 1000

  return setInterval(() => { atualizarCronometro(cronometro) }, tempoAtualizacaoCronometro)
}

function pararCronometro(cronometro) {
  clearInterval(cronometro)
}

function comecarJogo() {
  console.log(localStorage.getItem('temaEscolhido'), localStorage.getItem('dificuldade'))

  let dificuldadeOpcoes = {
    1: 'Fácil',
    2: 'Médio',
    3: 'Difícil'
  }

  let cartasUl = document.getElementById('cartas')
  let cartas = temas[localStorage.getItem('temaEscolhido')].icones
  let dificuldade = localStorage.getItem('dificuldade')

  cartas = definirDificuldade(dificuldade, cartas)
  cartas = criarCopiaCartas(cartas)
  cartas = embaralharCartas(cartas)
  carregarCartas(cartasUl, cartas)

  let parCartas = []
  let cartasButton = document.querySelectorAll('.selecionar-carta button')
  let cartasIguais = null
  let paresAchados = 0
  let totalPares = cartas.length / 2
  // let bloquearJogadas = false
  let numeroPalpites = 0
  let cronometro = Date.now()
  
  let idCronometro = iniciarCronometro(cronometro)

  document.querySelector('#informacoes-fim-jogo h2').textContent += dificuldadeOpcoes[dificuldade]

  document.getElementById('recomecar').addEventListener('click', () => {
    location.reload()
  })
  
  cartasButton.forEach(cartaButton => {
    cartaButton.addEventListener('click', async () => {
      if (parCartas.length < 2) { //   && bloquearJogadas == false
        parCartas.push(cartaButton)      
        
        bloquearCarta(cartaButton)
        revelarCarta(cartaButton, cartasUl)
        adicionarEfeitoCartaSelecionada(cartaButton)
      }

      if (parCartas.length === 2) {
        // bloquearJogadas = true
        await esperar(1000)
        removerEfeitoCartaSelecionada(parCartas[0])
        removerEfeitoCartaSelecionada(parCartas[1])
        cartasIguais = compararCartas(parCartas)

        if (cartasIguais === false) {
          // piscarTela('red')
          
          parCartas[0].classList.add('treme-treme')
          parCartas[1].classList.add('treme-treme')

          liberarCarta(parCartas[0])
          liberarCarta(parCartas[1])
          
          esconderCarta(parCartas[0])
          esconderCarta(parCartas[1])

          await esperar(1000)

          parCartas[0].classList.remove('treme-treme')
          parCartas[1].classList.remove('treme-treme')
        } else if (cartasIguais === true) {
          // piscarTela('green')
          paresAchados++

          parCartas[0].classList.add('escurecer')
          parCartas[1].classList.add('escurecer')
        }

        numeroPalpites++

        if (paresAchados === totalPares) {
          pararCronometro(idCronometro)
          vitoria(numeroPalpites, idCronometro)
        }

        [cartasIguais, parCartas] = resetarInformacoesRodada()
        // bloquearJogadas = false
      }
    }) 
  })
} 

document.addEventListener('DOMContentLoaded', () => {
  comecarJogo()
});
